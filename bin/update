#!/bin/bash

echo "ğŸ”„ Mise Ã  jour du projet..."

# Fonction pour gÃ©rer les erreurs
handle_error() {
    echo "âŒ Erreur: $1"
    exit 1
}

# Fonction pour mettre Ã  jour un dÃ©pÃ´t
update_repo() {
    local dir=$1
    echo "ğŸ“‚ Mise Ã  jour de $dir..."
    
    # VÃ©rifier si on est dans un dÃ©pÃ´t git
    if [ ! -d ".git" ]; then
        return 0  # Skip si pas de dÃ©pÃ´t git
    fi

    # Fetch depuis main
    echo "â¬‡ï¸  RÃ©cupÃ©ration des modifications depuis main..."
    if ! git fetch origin main; then
        handle_error "Impossible de rÃ©cupÃ©rer depuis main"
    fi

    # Tenter le merge
    echo "ğŸ”„ Fusion avec main..."
    if ! git merge origin/main; then
        echo "âš ï¸  Conflits dÃ©tectÃ©s!"
        echo "â¡ï¸  Veuillez rÃ©soudre les conflits manuellement:"
        echo "  1. Corrigez les fichiers en conflit"
        echo "  2. git add <fichiers>"
        echo "  3. git commit -m 'RÃ©solution des conflits'"
        echo "  4. Relancez bin/update"
        exit 1
    fi

    echo "âœ… Mise Ã  jour terminÃ©e"
}

# Mise Ã  jour du dÃ©pÃ´t principal
update_repo "dÃ©pÃ´t principal"

# Mise Ã  jour des sous-dossiers si nÃ©cessaire
for dir in api web mobile; do
    if [ -d "$dir" ]; then
        echo "ğŸ“‚ EntrÃ©e dans $dir..."
        cd $dir
        update_repo "$dir"
        cd ..
    fi
done

echo "âœ… Mise Ã  jour globale terminÃ©e!" 